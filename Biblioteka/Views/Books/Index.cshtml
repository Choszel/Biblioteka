@model IEnumerable<Biblioteka.Models.Book>

@{
    ViewData["Title"] = "Index";
}

<h1>Index</h1>

<p>
    <a asp-action="Create">Create New</a>
</p>
<table class="table">
    <thead>
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.bookPhoto)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.title)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.ISBN)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.description)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.releaseDate)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.stockLevel)
            </th>           
            <th>
                @Html.DisplayNameFor(model => model.price)
            </th>
            <th></th>
        </tr>
    </thead>
    <tbody>
@foreach (var item in Model) {
        <tr>
            <td>
                <img src=@item.bookPhoto />
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.title)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.ISBN)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.description)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.releaseDate)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.stockLevel)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.price)
            </td>
            <td>
                <a asp-action="Edit" asp-route-id="@item.bookId">Edit</a> |
                <a asp-action="Details" asp-route-id="@item.bookId">Details</a> |
                <a asp-action="Delete" asp-route-id="@item.bookId">Delete</a>
                    <a asp-action="Delete" asp-route-id="@item.bookId">Delete</a>
                    <button id="toBasket" onclick="addProduct(@item.bookId)">Dodaj do koszyka</button>
                </td>
            </tr>
        }
    </tbody>
</table>

<dialog id="dialog1">
    <h2>Dodano produkt</h2>
    <hr>
    <p>Produkt został dodany do koszyka</p>
    <form id="form1" method="dialog">
        <div>
            <input type="submit" value="OK">
        </div>
    </form>
</dialog>

<script>
    const form = document.getElementById("form1");
    const dlg = document.getElementById("dialog1");

    form.onsubmit = () => {
        dlg.close();
    }

    function addProduct(bookId) {
        var storedBooks = localStorage.getItem("books");
        var books = {};

        if (storedBooks) books = JSON.parse(storedBooks);

        if (books[bookId] != null) books[bookId] = books[bookId] + 1;
        else books[bookId] = 1;

        localStorage.setItem("books", JSON.stringify(books));

        let modif = (localStorage.getItem(-1).modif) + 1;
        localStorage.setItem((-1).toString(),
            JSON.stringify(
                {
                    modif: modif
                }));

        form.reset();
        dlg.showModal();
    }
</script>

